<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AgriConnect</title>


    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <link rel="stylesheet" href="style.css">


</head>

<body>
    <header class="header">
        <a href="#" class="logo"><i class="fas fa-shopping-basket"></i>Agriconnect</a>

        <nav class="navbar">
            <a href="#home">Home</a>
            <a href="#features">Features</a>
            <a href="#product">Product</a>
            <a href="#categories">Categories</a>
            <a href="#review">Review</a>
            <a href="{{ url_for('farmers') }}">Farmer</a>

        </nav>

        <div class="icons">
            <div class="fas fa-bars" id="menu-btn"></div>
            <a href="{{ url_for('cart') }}" title="Cart">
                <div class="fas fa-shopping-cart" id="cart-btn"></div>
            </a>
            <a href="{{ url_for('welcome') }}" title="User">
                <div class="fas fa-user" id="login-btn"></div>
            </a>

        </div>
        <form action="{{ url_for('search') }}" method="GET" class="search-form">
            <input type="search" id="search-box" name="query" placeholder="Search products..." required>
            <label for="search-box" class="fas fa-search"></label>
        </form>

    </header>
    <section class="home" id="home">
        <div class="content">
            <h3> Welcome <span>To </span>AgriConnect</h3>
            <h3>fresh and <span>organic </span> product for your</h3>
            <p>Unlocking the True Potential of Agriculture with Smart Connectivity, Real-Time Insights, and Market
                Access for Every Farmer</p>
            <a href="#" class="btn">shop now</a>
        </div>

    </section>
    <section class="features" id="features">
        <h1 class="heading"> our <span> features </span></h1>
        <div class="box-container">
            <div class="box">
                <img src="{{ url_for('static', filename='images/fersh.jpg') }}">
                <h3>fresh and organic</h3>
                <p id="text">
                    fresh food with good price
                    <span id="moretext" style="display: none;">
                        Fresh and organic food is grown naturally without the use of harmful chemicals, pesticides, or
                        synthetic fertilizers. It ensures better nutrition, rich taste, and improved health benefits.
                        Sourced directly from local farms, organic produce supports sustainable farming practices and
                        protects the environment. Choosing fresh and organic means choosing food that’s not only safer
                        but also better for your body and the planet.
                    </span>
                </p>
                <a href="#" class="btn" onclick="toggletext()">read more</a>
            </div>
            <div class="box">
                <img src="{{ url_for('static', filename='images/free.jpg') }}">
                <h3>free delivery</h3>
                <p id="text">
                    Fresh food with fastest delivery
                    <span id="moreText" style="display: none;">
                        AgriConnect offers the fastest delivery of fresh farm produce by connecting farmers directly
                        with buyers. Our efficient logistics and real-time tracking ensure quick, safe, and quality
                        delivery to your doorstep.
                        Experience hassle-free service with speed and freshness—making every order reliable, timely, and
                        straight from the farm.
                    </span>
                </p>
                </p>
                <a href="#" class="btn" onclick="toggleText()">read more</a>
            </div>
            <div class="box">
                <img src="{{ url_for('static', filename='images/pay.jpg') }}">
                <h3>Easy Payment</h3>
                <p id="teXt">
                    Easily payment anytime
                    <span id="MoreText" style="display: none;">
                        AgriConnect makes payments simple and secure with multiple options like UPI, cards, net banking,
                        and digital wallets. Our fast and reliable payment system ensures smooth transactions for both
                        farmers and buyers.
                        Enjoy a seamless checkout experience that’s safe, transparent, and designed for your
                        convenience—anytime, anywhere.
                    </span>
                </p>
                <a href="#" class="btn" onclick="toggleteXt()">read more</a>
            </div>
        </div>

    </section>
    <section class="Product" id="product">
        <h1 class="heading"> our <span> product </span></h1>

        <div class="view-more-container">
            <a href="{{ url_for('products') }}" class="btn view-more-btn">View More</a>
        </div>

        <!-- Swiper Container -->
        <div class="swiper product-slider">
            <div class="swiper-wrapper">
                {% for product in products %}
                <div class="swiper-slide box">
                    {% if product.image %}
                    <img src="{{ url_for('static', filename='uploads/' ~ product.image) }}" alt="{{ product.name }}">
                    {% else %}
                    <img src="{{ url_for('static', filename='images/default.jpg') }}" alt="default">
                    {% endif %}
                    <h3>{{ product.name }}</h3>
                    <span class="price">per kg ${{ product.price }}</span>
                    <span class="quantity">Qty: {{ product.qty }} kg</span>
                    <p class="farmer-info">By: {{ product.farmer_name }} ({{ product.shop_name }})</p>

                    <div class="stars" data-product-id="{{ product.id }}">
                        {% set avg_rating = product.avg_rating | default(0) %}
                        {% for i in range(1, 6) %}
                        {% if i <= (avg_rating | round(0, 'common' )) %} <i class="fas fa-star" data-rating="{{ i }}">
                            </i>
                            {% elif i - 0.5 <= avg_rating %} <i class="fas fa-star-half-alt" data-rating="{{ i }}"></i>
                                {% else %}
                                <i class="far fa-star" data-rating="{{ i }}"></i>
                                {% endif %}
                                {% endfor %}
                    </div>

                    <div class="rating-info">
                        <small style="color:#666;">
                            {{ "%.1f"|format(avg_rating | default(0)) }} ({{ product.total_ratings | default(0) }}
                            ratings)
                        </small>
                    </div>

                    <form action="{{ url_for('add_to_cart', product_id=product.id) }}" method="POST">
                        <button type="submit" class="btn">Add to cart</button>
                    </form>
                </div>
                {% endfor %}
            </div>

            <!-- Navigation Buttons -->
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
        </div>
    </section>


    <section class="categories" id="categories">
        <h1 class="heading">product<span>categories</span></h1>

        <div class="box-container">

            <div class="box">
                <img src="{{ url_for('static', filename='images/veg.jpg') }}">
                <h3>vegetables</h3>
                <p>upto 45% off</p>
                <a href="{{ url_for('vegetables') }}" class="btn"> shop now </a>
            </div>

            <div class="box">
                <img src="{{ url_for('static', filename='images/freshfruit.jpg') }}">
                <h3>fresh fruit</h3>
                <p>upto 45% off</p>
                <a href="{{ url_for('fruits') }}" class="btn"> shop now </a>
            </div>

            <div class="box">
                <img src="{{ url_for('static', filename='images/dairy.jpg') }}">
                <h3>dairy product</h3>
                <p>upto 45% off</p>
                <a href="{{ url_for('dairy') }}" class="btn"> shop now </a>
            </div>
        </div>

        <section class="review" id="review">
            <h1 class="heading">customer's <span>review</span></h1>

            <!-- Swiper Wrapper -->
            <div class="swiper mySwiper">
                <div class="swiper-wrapper">
                    {% if reviews and reviews|length > 0 %}
                    {% for r in reviews %}
                    <div class="swiper-slide">
                        <div class="box">
                            {% if r.photo %}
                            <img src="{{ url_for('static', filename='uploads/' + r.photo) }}" alt="{{ r.name }}"
                                class="review-avatar">
                            {% else %}
                            <img src="{{ url_for('static', filename='images/default_user.png') }}" alt="Default user"
                                class="review-avatar">
                            {% endif %}

                            <p>{{ r.review_text }}</p>
                            <h3>{{ r.name }}</h3>

                            {% if r.created_at %}
                            <small>Posted on {{ r.created_at.strftime('%d %b %Y') }}</small>
                            {% endif %}

                            <!-- Star Rating Display -->
                            <div class="stars">
                                {% for i in range(1, 6) %}
                                {% if i <= (r.rating|int if r.rating else 0) %} <i class="fas fa-star"></i>
                                    {% else %}
                                    <i class="far fa-star"></i>
                                    {% endif %}
                                    {% endfor %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    {% else %}
                    <!-- Fallback when no reviews -->
                    <div class="swiper-slide">
                        <div class="box">
                            <img src="{{ url_for('static', filename='images/default_user.png') }}" alt="Default user"
                                class="review-avatar">
                            <p>No reviews yet. Be the first to leave a review!</p>
                            <h3>Be the First</h3>
                            <div class="stars">
                                <i class="far fa-star"></i>
                                <i class="far fa-star"></i>
                                <i class="far fa-star"></i>
                                <i class="far fa-star"></i>
                                <i class="far fa-star"></i>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>

                <div class="swiper-pagination"></div>
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>

            </div>

            <!-- Review Form -->
            <div class="form-container">
                <h2>Post Your Review</h2>
                <form action="{{ url_for('reviews') }}" method="POST" enctype="multipart/form-data">
                    <input type="text" name="name" placeholder="Your Name" required>
                    <textarea name="review" placeholder="Write your review in 100 words..." required></textarea>
                    <label for="photo">Upload Photo (Max size: 4MB)</label>
                    <input type="file" id="photo" name="photo" accept="image/*" required>



                    <!-- Star Rating Input -->
                    <div class="star-rating">
                        <input type="radio" name="rating" id="star5" value="5" required><label for="star5"
                            title="5 stars">★</label>
                        <input type="radio" name="rating" id="star4" value="4"><label for="star4"
                            title="4 stars">★</label>
                        <input type="radio" name="rating" id="star3" value="3"><label for="star3"
                            title="3 stars">★</label>
                        <input type="radio" name="rating" id="star2" value="2"><label for="star2"
                            title="2 stars">★</label>
                        <input type="radio" name="rating" id="star1" value="1"><label for="star1"
                            title="1 star">★</label>
                    </div>

                    <button type="submit">Submit Review</button>
                </form>
            </div>
        </section>

        <section class="footer">
            <div class="footer-box">

                <!-- About -->
                <div class="footer-section">
                    <h3>AgriConnect <i class="fas fa-shopping-basket"></i></h3>
                    <p>
                        AgriConnect bridges the gap between farmers and consumers by delivering fresh, organic
                        produce
                        directly from farms to homes. Our platform empowers farmers with fair prices, modern tools,
                        and
                        market access while offering consumers healthy, chemical-free food.
                    </p>
                    <div class="share">
                        <a href="#" class="fab fa-facebook-f"></a>
                        <a href="#" class="fab fa-twitter"></a>
                        <a href="#" class="fab fa-instagram"></a>
                        <a href="#" class="fab fa-linkedin-in"></a>
                    </div>
                </div>

                <!-- Contact Info -->
                <div class="footer-section">
                    <h3>Contact Info</h3>
                    <a href="tel:+913453312346" class="links"> <i class="fas fa-phone"></i> +91-345-331-2346</a>
                    <a href="tel:+913457734653" class="links"> <i class="fas fa-phone"></i> +91-345-773-4653</a>
                    <a href="mailto:saktiraj12@gmail.com" class="links"> <i class="fas fa-envelope"></i>
                        saktiraj12@gmail.com</a>
                    <a href="#" class="links"> <i class="fas fa-map-marker-alt"></i> Gunupur, Odisha - 765022</a>
                </div>


                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <a href="#home" class="links"> <i class="fas fa-arrow-right"></i> Home </a>
                    <a href="#features" class="links"> <i class="fas fa-arrow-right"></i> Features </a>
                    <a href="#product" class="links"> <i class="fas fa-arrow-right"></i> Products </a>
                    <a href="#categories" class="links"> <i class="fas fa-arrow-right"></i> Categories </a>
                    <a href="#review" class="links"> <i class="fas fa-arrow-right"></i> Reviews </a>
                </div>


                <!-- Newsletter -->
                <div class="footer-section">
                    <h3>Newsletter</h3>
                    <p>Subscribe for the latest updates</p>
                    <form action="{{ url_for('news') }}" method="POST">
                        <input type="email" placeholder="Your email" class="email" required>
                        <input type="submit" value="Subscribe" class="btn">
                    </form>
                    <img src="{{ url_for('static', filename='images/py.jpg') }}" class="payment-img" alt="">
                </div>
            </div>
        </section>



        <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
        <script src="{{ url_for('static', filename='script.js') }}"></script>

        <script>
            // Toggle search box visibility
            const searchBtn = document.querySelector('#search-btn');
            const searchForm = document.querySelector('.search-form');
            searchBtn.onclick = () => {
                searchForm.classList.toggle('active');
            };

            document.addEventListener('DOMContentLoaded', function () {
                const starContainers = document.querySelectorAll('.Product .box .stars');

                starContainers.forEach(container => {
                    const stars = container.querySelectorAll('i');
                    const productId = container.dataset.productId;

                    stars.forEach((star, index) => {
                        star.addEventListener('click', function () {
                            // Reset all stars in this container
                            stars.forEach(s => s.classList.remove('fas', 'active'));
                            stars.forEach(s => s.classList.add('far'));

                            // Fill stars up to clicked one
                            for (let i = 0; i <= index; i++) {
                                stars[i].classList.remove('far');
                                stars[i].classList.add('fas', 'active');
                            }

                            // Send rating to backend
                            const rating = index + 1;
                            console.log(`Product ID: ${productId}, Rating: ${rating}`);

                            fetch('/rate-product', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    product_id: productId,
                                    rating: rating
                                })
                            })
                                .then(res => res.json())
                                .then(data => {
                                    if (data.success) {
                                        console.log('Rating saved successfully!');
                                        // Reload the page to show updated average rating
                                        setTimeout(() => {
                                            location.reload();
                                        }, 500); // Small delay to let user see the change
                                    } else {
                                        console.error('Error saving rating:', data.message);
                                        alert('Error: ' + data.message);
                                    }
                                })
                                .catch(err => {
                                    console.error('Network error:', err);
                                    alert('Network error occurred');
                                });
                        });
                    });
                });
            });
        </script>


</body>

</html>